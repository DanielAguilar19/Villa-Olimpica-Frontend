name: qa → main

on:
  workflow_run:
    workflows: ['Node CI']
    types: [completed]

jobs:
  open-pr:
    if: >-
      ${{
        github.event.workflow_run.conclusion == 'success' &&
        (
          github.event.workflow_run.head_branch == 'qa' ||
          (github.event.workflow_run.pull_requests && github.event.workflow_run.pull_requests[0] &&
           github.event.workflow_run.pull_requests[0].head.ref == 'qa')
        )
      }}
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Open PR qa → main
        uses: repo-sync/pull-request@v2
        with:
          source_branch: 'qa'
          destination_branch: 'main'
          github_token: '${{ secrets.GITHUB_TOKEN }}'
          pr_title: 'Promote qa → main'
          pr_body: 'PR automático tras CI exitoso en **qa**.'
          pr_label: 'auto,promote'
          pr_allow_empty: false
